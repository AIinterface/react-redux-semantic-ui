{"version":3,"sources":["webpack:///webpack/bootstrap da614d8fb0881bb43eb1","webpack:///external \"app\"","webpack:///external \"babel-runtime/core-js/json/stringify\"","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"compression\"","webpack:///external \"config\"","webpack:///external \"cookie-parser\"","webpack:///external \"express\"","webpack:///external \"helpers/ApiClient\"","webpack:///external \"helpers/Html\"","webpack:///external \"http\"","webpack:///external \"http-proxy\"","webpack:///external \"path\"","webpack:///external \"pretty-error\"","webpack:///external \"react\"","webpack:///external \"react-dom/server\"","webpack:///external \"react-redux\"","webpack:///external \"react-router\"","webpack:///external \"react-router-redux\"","webpack:///external \"react-router/lib/createMemoryHistory\"","webpack:///external \"redux-connect\"","webpack:///external \"redux/create\"","webpack:///external \"routes\"","webpack:///external \"serve-favicon\"","webpack:///./src/server.js"],"names":["parameters","process","on","console","error","targetUrl","apiHost","apiPort","pretty","app","server","Server","proxy","createProxyServer","target","ws","use","join","__dirname","get","req","res","sendFile","static","next","setHeader","ip","web","socket","head","code","headersSent","writeHead","json","reason","message","end","client","memoryHistory","originalUrl","store","history","hydrateOnClient","send","renderToString","chunks","__DISABLE_SSR__","routes","location","redirectLocation","renderProps","redirect","pathname","search","render","status","helpers","then","content","global","navigator","userAgent","headers","component","catch","mountError","port","listen","err","info","title","host"],"mappings":"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","file":"server.build.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"http://localhost:3001/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 23);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap da614d8fb0881bb43eb1","module.exports = require(\"app\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"app\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"babel-runtime/core-js/json/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/core-js/json/stringify\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"babel-runtime/helpers/extends\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-runtime/helpers/extends\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"config\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"config\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"helpers/ApiClient\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helpers/ApiClient\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"helpers/Html\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helpers/Html\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"http-proxy\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http-proxy\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"pretty-error\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pretty-error\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"react\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"react-dom/server\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-dom/server\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"react-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-redux\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"react-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"react-router-redux\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router-redux\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"react-router/lib/createMemoryHistory\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react-router/lib/createMemoryHistory\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"redux-connect\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux-connect\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"redux/create\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redux/create\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"routes\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"routes\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"serve-favicon\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"serve-favicon\"\n// module id = 22\n// module chunks = 0","import express from 'express';\nimport React from 'react';\nimport ReactDOM from 'react-dom/server';\nimport favicon from 'serve-favicon';\nimport compression from 'compression';\nimport cookieParser from 'cookie-parser';\nimport httpProxy from 'http-proxy';\nimport path from 'path';\nimport PrettyError from 'pretty-error';\nimport http from 'http';\nimport { match } from 'react-router';\nimport { syncHistoryWithStore } from 'react-router-redux';\nimport { ReduxAsyncConnect, loadOnServer } from 'redux-connect';\nimport createHistory from 'react-router/lib/createMemoryHistory';\nimport { Provider } from 'react-redux';\nimport config from 'config';\nimport createStore from 'redux/create';\nimport ApiClient from 'helpers/ApiClient';\nimport Html from 'helpers/Html';\nimport getRoutes from 'routes';\nimport { exposeInitialRequest } from 'app';\n\nexport default function (parameters) {\n  process.on('unhandledRejection', error => console.error(error));\n\n  const targetUrl = `http://${config.apiHost}:${config.apiPort}`;\n  const pretty = new PrettyError();\n  const app = express();\n  const server = new http.Server(app);\n  const proxy = httpProxy.createProxyServer({\n    target: targetUrl,\n    ws: true\n  });\n\n  app.use(cookieParser());\n  app.use(compression());\n  app.use(favicon(path.join(__dirname, '..', 'static', 'favicon.ico')));\n  app.get('/manifest.json', (req, res) => res.sendFile(path.join(__dirname, '..', 'static', 'manifest.json')));\n\n  app.use(express.static(path.join(__dirname, '..', 'static')));\n\n  app.use((req, res, next) => {\n    res.setHeader('Service-Worker-Allowed', '*');\n    res.setHeader('X-Forwarded-For', req.ip);\n    return next();\n  });\n\n  // Proxy to API server\n  app.use('/api', (req, res) => {\n    proxy.web(req, res, { target: targetUrl });\n  });\n\n  app.use('/ws', (req, res) => {\n    proxy.web(req, res, { target: `${targetUrl}/ws` });\n  });\n\n  server.on('upgrade', (req, socket, head) => {\n    proxy.ws(req, socket, head);\n  });\n\n  // added the error handling to avoid https://github.com/nodejitsu/node-http-proxy/issues/527\n  proxy.on('error', (error, req, res) => {\n    if (error.code !== 'ECONNRESET') {\n      console.error('proxy error', error);\n    }\n    if (!res.headersSent) {\n      res.writeHead(500, { 'content-type': 'application/json' });\n    }\n\n    const json = { error: 'proxy_error', reason: error.message };\n    res.end(JSON.stringify(json));\n  });\n\n  app.use((req, res) => {\n    if (__DEVELOPMENT__) {\n      // Do not cache webpack stats: the script file would change since\n      // hot module replacement is enabled in the development env\n      // webpackIsomorphicTools.refresh(); // TODO check this for universal-webpack\n    }\n    const client = new ApiClient(req);\n    const memoryHistory = createHistory(req.originalUrl);\n    const store = createStore(memoryHistory, client);\n    const history = syncHistoryWithStore(memoryHistory, store);\n\n    function hydrateOnClient() {\n      res.send(`<!doctype html>\n      ${ReactDOM.renderToString(<Html assets={parameters.chunks()} store={store} />)}`);\n    }\n\n    if (__DISABLE_SSR__) {\n      return hydrateOnClient();\n    }\n\n    // Re-configure restApp for apply client cookies\n    exposeInitialRequest(req);\n\n    match({\n      history,\n      routes: getRoutes(store),\n      location: req.originalUrl\n    }, (error, redirectLocation, renderProps) => {\n      if (redirectLocation) {\n        res.redirect(redirectLocation.pathname + redirectLocation.search);\n      } else if (error) {\n        console.error('ROUTER ERROR:', pretty.render(error));\n        res.status(500);\n        hydrateOnClient();\n      } else if (renderProps) {\n        loadOnServer({ ...renderProps, store, helpers: { client } }).then(() => {\n          const content = (\n            <Provider store={store} key=\"provider\">\n              <ReduxAsyncConnect {...renderProps} />\n            </Provider>\n          );\n\n          res.status(200);\n\n          global.navigator = { userAgent: req.headers['user-agent'] };\n\n          const component = <Html assets={parameters.chunks()} component={content} store={store} />;\n\n          res.send(`<!doctype html>${ReactDOM.renderToString(component)}`);\n        }).catch(mountError => {\n          console.error('MOUNT ERROR:', pretty.render(mountError));\n          res.status(500);\n          hydrateOnClient();\n        });\n      } else {\n        res.status(404).send('Not found');\n      }\n    });\n  });\n\n  if (config.port) {\n    server.listen(config.port, err => {\n      if (err) {\n        console.error(err);\n      }\n      console.info('----\\n==> ✅  %s is running, talking to API server on %s.', config.app.title, config.apiPort);\n      console.info('==> 💻  Open http://%s:%s in a browser to view the app.', config.host, config.port);\n    });\n  } else {\n    console.error('==>     ERROR: No PORT environment variable has been specified');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server.js"],"sourceRoot":""}